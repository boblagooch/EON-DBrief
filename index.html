<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debrief</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue:wght@400&family=Roboto+Condensed:wght@400;700&display=swap');
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Roboto Condensed', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #2C3E50 0%, #34495E 25%, #5D6D7E 75%, #85929E 100%);
      position: relative;
      overflow-x: hidden;
    }
    
    /* Animated geometric shapes */
    .bg-shapes {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 2;
      pointer-events: none;
      overflow: hidden;
    }
    
    .shape {
      position: absolute;
      opacity: 0.1;
      animation: float 20s infinite linear;
    }
    
    .shape-1 {
      width: 0;
      height: 0;
      border-left: 50px solid transparent;
      border-right: 50px solid transparent;
      border-bottom: 80px solid #85C1E9;
      top: 10%;
      left: 5%;
      animation-duration: 25s;
    }
    
    .shape-2 {
      width: 60px;
      height: 60px;
      background: #5DADE2;
      transform: rotate(45deg);
      top: 60%;
      right: 10%;
      animation-duration: 30s;
      animation-direction: reverse;
    }
    
    .shape-3 {
      width: 0;
      height: 0;
      border-top: 40px solid #AED6F1;
      border-left: 25px solid transparent;
      border-right: 25px solid transparent;
      top: 80%;
      left: 15%;
      animation-duration: 35s;
    }
    
    .shape-4 {
      width: 80px;
      height: 20px;
      background: linear-gradient(90deg, #5DADE2, #85C1E9);
      top: 20%;
      right: 20%;
      animation-duration: 28s;
    }
    
    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-20px) rotate(90deg); }
      50% { transform: translateY(0) rotate(180deg); }
      75% { transform: translateY(-10px) rotate(270deg); }
      100% { transform: translateY(0) rotate(360deg); }
    }
    
    .overlay {
      background: 
        radial-gradient(ellipse at center, rgba(44, 62, 80, 0.6) 0%, rgba(44, 62, 80, 0.8) 100%),
        linear-gradient(45deg, rgba(93, 173, 226, 0.1) 0%, rgba(133, 193, 233, 0.1) 100%);
      min-height: 100vh;
      padding: 1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      z-index: 10;
    }
    
    .container {
      background: 
        linear-gradient(135deg, 
          rgba(52, 73, 94, 0.92) 0%, 
          rgba(44, 62, 80, 0.95) 50%, 
          rgba(93, 109, 126, 0.92) 100%
        );
      backdrop-filter: blur(10px);
      border: 2px solid #AED6F1;
      box-shadow: 
        0 0 20px rgba(174, 214, 241, 0.2),
        inset 0 0 15px rgba(174, 214, 241, 0.05);
      padding: 2.5rem;
      max-width: 650px;
      width: 100%;
      border-radius: 0;
      position: relative;
      animation: fadeIn 1s ease-in;
      color: #FFF;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, #AED6F1, #5DADE2, #AED6F1, #5DADE2);
      border-radius: 0;
      z-index: -1;
      animation: borderGlow 4s ease-in-out infinite alternate;
    }
    
    @keyframes borderGlow {
      0% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    /* Cyrillic Graphics */
    .cyrillic-text {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }
    
    .cyrillic-main {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 2.2rem;
      color: #D5DBDB;
      text-transform: uppercase;
      letter-spacing: 3px;
      text-shadow: 
        2px 2px 4px rgba(0, 0, 0, 0.8),
        0 0 15px rgba(213, 219, 219, 0.3);
      margin-bottom: 0.5rem;
      position: relative;
      font-weight: 900;
    }
    
    .cyrillic-main::before,
    .cyrillic-main::after {
      content: '‚ñ¨';
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: #5DADE2;
      font-size: 1rem;
    }
    
    .cyrillic-main::before {
      left: -30px;
    }
    
    .cyrillic-main::after {
      right: -30px;
    }
    
    .cyrillic-sub {
      font-family: 'Roboto Condensed', sans-serif;
      font-size: 1.1rem;
      color: #85C1E9;
      font-weight: 900;
      letter-spacing: 2px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      font-style: italic;
    }
    
    h1 {
      text-align: center;
      color: #D5DBDB;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 3.5rem;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 4px;
      text-shadow: 
        0 0 8px rgba(213, 219, 219, 0.3),
        2px 2px 4px rgba(0, 0, 0, 0.6);
      position: relative;
    }
    
    h1::after {
      content: '‚òÖ';
      position: absolute;
      right: -40px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.6em;
      color: #5DADE2;
      animation: pulse 2s infinite;
    }
    
    h1::before {
      content: '‚òÖ';
      position: absolute;
      left: -40px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.6em;
      color: #5DADE2;
      animation: pulse 2s infinite 1s;
    }
    
    @keyframes pulse {
      0%, 100% { transform: translateY(-50%) scale(1); opacity: 1; }
      50% { transform: translateY(-50%) scale(1.2); opacity: 0.7; }
    }
    
    p.prompt {
      font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
      font-size: 1rem;
      color: #F8F9FA;
      margin-bottom: 2rem;
      text-align: center;
      line-height: 1.6;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
      border-left: 3px solid #AED6F1;
      padding-left: 1rem;
      background: rgba(0, 0, 0, 0.15);
      padding: 1rem;
      border-radius: 0;
      font-weight: 400;
    }
    
    .step-counter {
      text-align: center;
      color: #AED6F1;
      font-size: 1.1rem;
      margin-bottom: 1.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }
    
    label {
      display: block;
      margin-top: 1.5rem;
      font-weight: 700;
      color: #D5DBDB;
      font-size: 1.2rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      border-bottom: 2px solid rgba(174, 214, 241, 0.3);
      padding-bottom: 0.5rem;
    }
    
    select {
      width: 100%;
      height: 60px;
      margin-top: 1rem;
      padding: 1rem;
      font-family: 'Roboto Condensed', sans-serif;
      border: 2px solid #85C1E9;
      border-radius: 0;
      background: linear-gradient(135deg, rgba(52, 73, 94, 0.9), rgba(93, 109, 126, 0.9));
      color: #F8F9FA;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8);
    }
    
    select:focus {
      outline: none;
      border-color: #AED6F1;
      box-shadow: 0 0 15px rgba(174, 214, 241, 0.4);
      background: linear-gradient(135deg, rgba(93, 109, 126, 0.9), rgba(52, 73, 94, 0.9));
      transform: scale(1.02);
    }
    
    select:hover {
      border-color: #AED6F1;
      transform: translateY(-1px);
    }
    
    select option {
      background: #34495E;
      color: #F8F9FA;
      padding: 0.5rem;
    }
    
    textarea {
      width: 100%;
      min-height: 100px;
      max-height: 300px;
      margin-top: 1rem;
      padding: 1rem;
      font-family: 'Roboto Condensed', sans-serif;
      border: 2px solid #85C1E9;
      border-radius: 0;
      background: linear-gradient(135deg, rgba(52, 73, 94, 0.8), rgba(93, 109, 126, 0.8));
      color: #F8F9FA;
      font-size: 1.1rem;
      font-weight: 400;
      resize: none;
      transition: all 0.3s ease, height 0.2s ease;
      text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
      line-height: 1.5;
    }
    
    textarea:focus {
      outline: none;
      border-color: #AED6F1;
      box-shadow: 0 0 15px rgba(174, 214, 241, 0.4);
      background: linear-gradient(135deg, rgba(93, 109, 126, 0.8), rgba(52, 73, 94, 0.8));
      transform: scale(1.01);
    }
    
    textarea::placeholder {
      color: rgba(248, 249, 250, 0.6);
      font-style: italic;
    }
    
    .char-counter {
      text-align: right;
      font-size: 0.9rem;
      color: #AED6F1;
      margin-top: 0.5rem;
      font-weight: 700;
      text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8);
    }
    
    .button-container {
      margin-top: 2.5rem;
      display: flex;
      gap: 1rem;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    
    button {
      padding: 1.2rem 2.5rem;
      border: 2px solid #85C1E9;
      border-radius: 0;
      cursor: pointer;
      font-size: 1.1rem;
      font-family: 'Roboto Condensed', sans-serif;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 
        0 4px 8px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(174, 214, 241, 0.2);
      transition: all 0.3s ease;
      min-width: 140px;
      position: relative;
      overflow: hidden;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 6px 12px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(174, 214, 241, 0.3);
    }
    
    button:active {
      transform: translateY(0);
      transition: all 0.1s ease;
    }
    
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    button:hover::before {
      left: 100%;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #5DADE2, #85C1E9);
      color: #2C3E50;
      text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3);
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #85C1E9, #AED6F1);
      box-shadow: 
        0 8px 16px rgba(0, 0, 0, 0.4),
        0 0 20px rgba(174, 214, 241, 0.3);
      transform: translateY(-3px) scale(1.02);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(93, 109, 126, 0.8));
      color: #F8F9FA;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }
    
    .btn-secondary:hover {
      background: linear-gradient(135deg, rgba(93, 109, 126, 0.8), rgba(133, 147, 158, 0.8));
      box-shadow: 
        0 8px 16px rgba(0, 0, 0, 0.4),
        0 0 20px rgba(174, 214, 241, 0.2);
      transform: translateY(-3px) scale(1.02);
    }
    
    .step {
      display: none;
      animation: slideInRight 0.4s ease-out;
    }
    
    .step.active {
      display: block !important;
    }
    
    @keyframes slideInRight {
      from { 
        opacity: 0; 
        transform: translateX(30px);
      }
      to { 
        opacity: 1; 
        transform: translateX(0);
      }
    }
    
    .confirmation {
      display: none;
      text-align: center;
      color: #AED6F1;
      margin-top: 2rem;
      animation: celebrationPulse 0.8s ease-out;
    }
    
    @keyframes celebrationPulse {
      0% { 
        opacity: 0; 
        transform: scale(0.8);
      }
      50% { 
        transform: scale(1.05);
      }
      100% { 
        opacity: 1; 
        transform: scale(1);
      }
    }
    
    .confirmation h2 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 2.5rem;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 3px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      color: #D5DBDB;
    }
    
    .confirmation p {
      font-size: 1.2rem;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      color: #F8F9FA;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
        margin: 0.25rem;
        max-width: 98%;
      }
      
      .cyrillic-text {
        margin-bottom: 1rem;
      }
      
      .cyrillic-main {
        font-size: 1.6rem;
        letter-spacing: 2px;
        margin-bottom: 0.25rem;
      }
      
      .cyrillic-sub {
        font-size: 0.9rem;
        letter-spacing: 1px;
      }
      
      h1 {
        font-size: 2rem;
        letter-spacing: 2px;
        margin-bottom: 0.25rem;
      }
      
      h1::before,
      h1::after {
        display: none;
      }
      
      p.prompt {
        font-size: 0.85rem;
        margin-bottom: 1rem;
        padding: 0.75rem;
        line-height: 1.4;
      }
      
      .step-counter {
        font-size: 0.9rem;
        margin-bottom: 1rem;
      }
      
      label {
        font-size: 1rem;
        margin-top: 1rem;
        padding-bottom: 0.25rem;
      }
      
      select {
        height: 50px;
        font-size: 1rem;
        padding: 0.75rem;
        margin-top: 0.5rem;
      }
      
      textarea {
        font-size: 1rem;
        padding: 0.75rem;
        min-height: 70px;
        margin-top: 0.5rem;
      }
      
      .char-counter {
        font-size: 0.8rem;
        margin-top: 0.25rem;
      }
      
      .button-container {
        margin-top: 1.5rem;
        gap: 0.75rem;
      }
      
      button {
        padding: 1rem 1.5rem;
        font-size: 1rem;
        min-height: 50px;
        min-width: 120px;
      }
    }
    
    @media (max-width: 480px) {
      .container {
        padding: 0.75rem;
        margin: 0.125rem;
      }
      
      .cyrillic-main {
        font-size: 1.4rem;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      p.prompt {
        font-size: 0.8rem;
        padding: 0.5rem;
      }
      
      .button-container {
        flex-direction: column;
        gap: 0.75rem;
      }
      
      button {
        width: 100%;
        padding: 0.875rem 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="bg-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
    <div class="shape shape-4"></div>
  </div>

  <div class="overlay">
    <div class="container">
      <div class="cyrillic-text">
        <div class="cyrillic-main">–ü–û–ß–ê–°–û–í–û–ô –ñ–£–†–ù–ê–õ</div>
        <div class="cyrillic-sub">–°–ü–ò–ö–ò–ó–ò</div>
      </div>
      
      <h1>EON Check In</h1>
      <p class="prompt">
        Feel free to answer any or all of these questions. Answers will help us to identify and address service issues.<br>
        <strong>Note:</strong> If you have an issue or concern that is more severe than this form allows for PLEASE bring it to someone you trust.
      </p>
      
      <form id="reflectionForm" role="form">
        <div class="step-counter" id="stepCounter">Question 1 of 4</div>
        
        <div class="step active" id="step-1">
          <label for="q1-category">1. What's one thing that went really well tonight?</label>
          <select id="q1-category">
            <option value="">-- Select a category --</option>
            <option value="Food">Food</option>
            <option value="Guest interaction">Guest interaction</option>
            <option value="Teamwork">Teamwork</option>
            <option value="Timing">Timing</option>
            <option value="Other">Other</option>
          </select>
          <textarea id="q1" maxlength="250" placeholder="Want to elaborate? Drop a note here."></textarea>
          <div class="char-counter" id="q1-counter">0/250 characters</div>
        </div>

        <div class="step" id="step-2">
          <label for="q2-category">2. Care to highlight a moment of support that stood out tonight?</label>
          <select id="q2-category">
            <option value="">-- Select a support moment type --</option>
            <option value="Server to Server">Server to Server</option>
            <option value="Server to Runner">Server to Runner</option>
            <option value="Runner to Host">Runner to Host</option>
            <option value="Host to Server">Host to Server</option>
            <option value="Whole Team">Whole Team</option>
            <option value="Guest to Team">Guest to Team</option>
            <option value="Other / Not Sure">Other / Not Sure</option>
          </select>
          <textarea id="q2" maxlength="250" placeholder="What happened and who was involved?"></textarea>
          <div class="char-counter" id="q2-counter">0/250 characters</div>
        </div>

        <div class="step" id="step-3">
          <label for="q3-category">3. Was there something that could have gone more smoothly tonight?</label>
          <select id="q3-category">
            <option value="">-- What area was this about? --</option>
            <option value="Timing">Timing</option>
            <option value="Guest experience">Guest experience</option>
            <option value="Communication">Communication</option>
            <option value="Turns">Turns</option>
            <option value="Other">Other</option>
          </select>
          <textarea id="q3" maxlength="250" placeholder="Want to share more details?"></textarea>
          <div class="char-counter" id="q3-counter">0/250 characters</div>
        </div>

        <div class="step" id="step-4">
          <label for="q4-category">4. Any thoughts on what we could improve to make things smoother?</label>
          <select id="q4-category">
            <option value="">-- What area does this relate to? --</option>
            <option value="Communication">Communication</option>
            <option value="Timing">Timing</option>
            <option value="Turns">Turns</option>
            <option value="Team support">Team support</option>
            <option value="Guest experience">Guest experience</option>
            <option value="Other">Other</option>
          </select>
          <textarea id="q4" maxlength="250" placeholder="Even a small idea can help!"></textarea>
          <div class="char-counter" id="q4-counter">0/250 characters</div>
        </div>

        <div class="button-container" id="navigationButtons">
          <button type="button" id="backBtn" class="btn-secondary" style="display: none;">‚Üê Back</button>
          <div style="display: flex; gap: 1rem;">
            <button type="button" id="skipBtn" class="btn-secondary">Skip</button>
            <button type="button" id="nextBtn" class="btn-primary">Next ‚Üí</button>
          </div>
        </div>
        
        <div class="button-container" id="finalButtons" style="display: none;">
          <button type="button" id="backBtn4" class="btn-secondary">‚Üê Back</button>
          <button type="button" id="skipSubmitBtn" class="btn-primary">Skip/Submit</button>
        </div>
      </form>
      
      <div class="confirmation" id="confirmation">
        <h2>Thanks for reflecting! üåü</h2>
        <p>Your feedback helps make our team stronger.</p>
        <div style="font-size: 4rem; margin: 2rem 0;">üêï</div>
      </div>
    </div>
  </div>

  <script>
    console.log('Script is loading...');

    document.addEventListener('DOMContentLoaded', function () {
      console.log('DOM loaded, initializing form...');
      
      const elements = {
        steps: document.querySelectorAll('.step'),
        form: document.getElementById('reflectionForm'),
        confirmation: document.getElementById('confirmation'),
        stepCounter: document.getElementById('stepCounter'),
        navigationButtons: document.getElementById('navigationButtons'),
        finalButtons: document.getElementById('finalButtons')
      };
      
      let currentStep = 0;
      
      // Debounce function for performance
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      try {
        // Initialize character counters and auto-expanding textareas
        function initCharCounters() {
          const textareas = document.querySelectorAll('textarea');
          textareas.forEach(textarea => {
            const counterId = textarea.id + '-counter';
            const counter = document.getElementById(counterId);
            
            if (!counter) return;
            
            // Debounced auto-expand functionality
            const debouncedAutoExpand = debounce(() => {
              textarea.style.height = 'auto';
              textarea.style.height = Math.min(textarea.scrollHeight, 300) + 'px';
            }, 50);
            
            function updateCounter() {
              try {
                const remaining = textarea.value.length;
                const max = textarea.maxLength;
                counter.textContent = `${remaining}/${max} characters`;
                
                counter.style.color = remaining > max * 0.9 ? '#5DADE2' : '#AED6F1';
                debouncedAutoExpand();
              } catch (error) {
                console.error('Counter update error:', error);
              }
            }
            
            // Event listeners
            textarea.addEventListener('input', updateCounter);
            textarea.addEventListener('paste', () => setTimeout(updateCounter, 10));
            
            updateCounter(); // Initialize
          });
        }

        function showStep(index) {
          try {
            console.log('Showing step:', index, 'Total steps:', elements.steps.length);
            
            if (!elements.steps[index]) {
              console.error('Step not found:', index);
              return;
            }
            
            // Hide all steps using direct style manipulation
            elements.steps.forEach((step, i) => {
              step.style.display = 'none';
              step.classList.remove('active');
            });
            
            // Show current step using direct style manipulation
            elements.steps[index].style.display = 'block';
            elements.steps[index].classList.add('active');
            
            // Verify the changes
            elements.steps.forEach((step, i) => {
              const isVisible = step.style.display === 'block';
              const hasActiveClass = step.classList.contains('active');
              console.log(`Step ${i + 1} (${step.id}): Display=${step.style.display}, Active=${hasActiveClass}`);
            });
            
            // Update step counter
            if (elements.stepCounter) {
              elements.stepCounter.textContent = `Question ${index + 1} of ${elements.steps.length}`;
            }
            
            updateNavigation();
          } catch (error) {
            console.error('Show step error:', error);
          }
        }

        function updateNavigation() {
          try {
            const isLastStep = currentStep === elements.steps.length - 1;
            const backBtn = document.getElementById('backBtn');
            
            // Show/hide navigation containers
            if (elements.navigationButtons) {
              elements.navigationButtons.style.display = isLastStep ? 'none' : 'flex';
            }
            if (elements.finalButtons) {
              elements.finalButtons.style.display = isLastStep ? 'flex' : 'none';
            }
            
            // Update back button visibility
            if (backBtn) {
              backBtn.style.display = currentStep > 0 ? 'inline-block' : 'none';
            }
          } catch (error) {
            console.error('Navigation update error:', error);
          }
        }

        function submitForm() {
          try {
            if (elements.form) elements.form.style.display = 'none';
            if (elements.confirmation) elements.confirmation.style.display = 'block';
            if (elements.stepCounter) elements.stepCounter.style.display = 'none';
          } catch (error) {
            console.error('Submit form error:', error);
          }
        }

        // Navigation functions
        function goNext() {
          if (currentStep < elements.steps.length - 1) {
            currentStep++;
            showStep(currentStep);
          }
        }

        function goBack() {
          if (currentStep > 0) {
            currentStep--;
            showStep(currentStep);
          }
        }

        // Static event listeners
        function attachEventListeners() {
          const eventMappings = [
            { id: 'nextBtn', event: 'click', handler: goNext },
            { id: 'skipBtn', event: 'click', handler: goNext },
            { id: 'backBtn', event: 'click', handler: goBack },
            { id: 'backBtn4', event: 'click', handler: goBack },
            { id: 'skipSubmitBtn', event: 'click', handler: submitForm }
          ];

          eventMappings.forEach(({ id, event, handler }) => {
            const element = document.getElementById(id);
            if (element) {
              element.addEventListener(event, handler);
            }
          });
        }

        // Initialize everything
        initCharCounters();
        // attachEventListeners(); // Removed to prevent double binding
        showStep(currentStep);
        
        // Data collection preparation
        window.formData = {
          sessionStart: Date.now(),
          responses: {},
          interactions: [],
          deviceType: window.innerWidth <= 768 ? 'mobile' : 'desktop'
        };
        
        // Track interactions
        function trackInteraction(type, element, data = {}) {
          window.formData.interactions.push({
            timestamp: Date.now(),
            type: type,
            element: element,
            data: data
          });
        }
        
        // Enhanced event listeners with tracking
        function attachEventListenersWithTracking() {
          const eventMappings = [
            { id: 'nextBtn', event: 'click', handler: () => { trackInteraction('next', currentStep); goNext(); } },
            { id: 'skipBtn', event: 'click', handler: () => { trackInteraction('skip', currentStep); goNext(); } },
            { id: 'backBtn', event: 'click', handler: () => { trackInteraction('back', currentStep); goBack(); } },
            { id: 'backBtn4', event: 'click', handler: () => { trackInteraction('back', currentStep); goBack(); } },
            { id: 'skipSubmitBtn', event: 'click', handler: () => { trackInteraction('submit', 'final'); collectFormData(); submitForm(); } }
          ];

          eventMappings.forEach(({ id, event, handler }) => {
            const element = document.getElementById(id);
            if (element) {
              element.addEventListener(event, handler);
            }
          });
          
          // Track form field interactions
          document.querySelectorAll('select, textarea').forEach(element => {
            element.addEventListener('focus', () => trackInteraction('focus', element.id));
            element.addEventListener('change', () => trackInteraction('change', element.id, { value: element.value }));
          });
        }
        
        function collectFormData() {
          // Collect all form responses
          for (let i = 1; i <= 4; i++) {
            const category = document.getElementById(`q${i}-category`)?.value || '';
            const text = document.getElementById(`q${i}`)?.value || '';
            window.formData.responses[`question${i}`] = {
              category: category,
              text: text,
              completed: !!(category || text)
            };
          }
          
          window.formData.sessionEnd = Date.now();
          window.formData.sessionDuration = window.formData.sessionEnd - window.formData.sessionStart;
          
          console.log('Form data collected:', window.formData);
          // Ready for external service integration
        }
        
        // Replace the original attachEventListeners call
        attachEventListenersWithTracking();
        
      } catch (error) {
        console.error('Initialization error:', error);
        // Fallback: at least show the first step
        if (elements.steps[0]) {
          elements.steps[0].style.display = 'block';
        }
      }
    });
  </script>
</body>
</html>